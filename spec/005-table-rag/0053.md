## 后端数据表

### mysql表结构
```sql
-- 文件表
CREATE TABLE `t_file` (
    `id` varchar(100) NOT NULL DEFAULT '' COMMENT 'id',
    `type` varchar(50) NOT NULL COMMENT '文件类型: csv, excel',
    `name` varchar(100) DEFAULT NULL COMMENT '文件名称',
    `path` varchar(200) NOT NULL COMMENT '文件地址: oss路径',
    `size` bigint(20) DEFAULT NULL COMMENT '文件大小',
    `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='文件表';
  
-- 知识库表
CREATE TABLE `t_dataset` (
    `id` varchar(100) NOT NULL DEFAULT '' COMMENT 'id',
    `name` varchar(100) DEFAULT NULL COMMENT '知识库名称',
    `description` varchar(200) NOT NULL COMMENT '知识库描述',
    `type` varchar(50) NOT NULL COMMENT '知识库类型: upload(文件上传), remote(远程数据库)',
    `table_name` varchar(50) NOT NULL COMMENT 'es索引名称(数据表名称)',
    `table_schema` text NOT NULL COMMENT '数据表schema(json字符串)',
    `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='知识库表';

ALTER TABLE t_dataset ADD CONSTRAINT unique_name UNIQUE(name);

-- 知识库-文件映射表
CREATE TABLE `t_dataset_file` (
   `id` varchar(100) NOT NULL DEFAULT '' COMMENT 'id',
   `dataset_id` varchar(100) NOT NULL DEFAULT '' COMMENT '知识库id',
   `file_id` varchar(100) NOT NULL DEFAULT '' COMMENT '文件id',
   PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='知识库-文件映射表';


-- 任务表
CREATE TABLE `t_task` (
   `id` varchar(100) NOT NULL DEFAULT '' COMMENT 'id',
   `dataset_id` varchar(100) NOT NULL DEFAULT '' COMMENT '知识库id',
   `file_id` varchar(100) NOT NULL DEFAULT '' COMMENT '文件id',
   `status` int(2) DEFAULT '0' COMMENT '任务状态, 0:已创建任务,等待处理;1:处理中;2:处理完成;3:处理失败 ',
   `error` text DEFAULT NULL COMMENT '任务失败原因',
   `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
   `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
   PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='任务表';
```

#### 字段说明

t_dataset表table_name字段: 用户定义的数据表名称, 需全局唯一, 对应es索引名称
t_dataset表table_schema字段: json字符串, 字段名称及字段类型

##### upload类型
```json
[{
  "name": "字段名称-1",
  "type": "字段类型(string,long,double,datatime(yyyy-MM-dd HH:mm:ss))",
  "description": "用户定义字段描述"
},{
  "name": "字段名称-2",
  "type": "字段类型(string,long,double,datatime(yyyy-MM-dd HH:mm:ss))",
  "description": "用户定义字段描述"
}]
```

#### remote类型
```json
[{
  "name": "字段名称-1",
  "type": "原始字段类型",
  "description": "原始字段描述"
},{
  "name": "字段名称-2",
  "type": "原始字段类型",
  "description": "原始字段描述"
}]
```

#### 表说明
`t_file`: 存储文件元数据
`t_dataset`: 存储用户创建的知识库元数据
`t_dataset_file`: 知识库关联的文件列表